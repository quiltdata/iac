# Terraform configuration for inline IAM pattern (backward compatible)
# Generated by tf_deploy.py

# Monolithic Stack - single CloudFormation stack with IAM inline
resource "aws_cloudformation_stack" "quilt" {
  name = var.name

  template_url = var.template_url

  capabilities = ["CAPABILITY_IAM", "CAPABILITY_NAMED_IAM"]

  parameters = {
    # Network parameters
    VPC           = var.vpc_id
    PublicSubnets = join(",", var.subnet_ids)
    Subnets       = join(",", var.subnet_ids)

    # DNS/TLS parameters
    CertificateArnELB = var.certificate_arn
    QuiltWebHost      = var.quilt_web_host

    # Admin parameters
    AdminEmail = var.admin_email

    # Database parameters
    DBInstanceClass = var.db_instance_class

    # Search parameters
    SearchInstanceType = var.search_instance_type
    SearchVolumeSize   = var.search_volume_size
  }

  tags = {
    Name        = var.name
    Component   = "Monolithic"
    Environment = "{{ config.environment }}"
  }
}

# Outputs
output "app_stack_name" {
  description = "Application stack name"
  value       = aws_cloudformation_stack.quilt.name
}

output "app_stack_id" {
  description = "Application stack ID"
  value       = aws_cloudformation_stack.quilt.id
}

output "quilt_url" {
  description = "Quilt application URL"
  value       = "https://${var.quilt_web_host}"
}

output "stack_outputs" {
  description = "Stack outputs"
  value       = aws_cloudformation_stack.quilt.outputs
  sensitive   = false
}
